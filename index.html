<!DOCTYPE html>
<html lang="ur">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAMING HUB | FINAL MASTER V2</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #00f2ff; --secondary: #7000ff; --bg: #050b18; --glass: rgba(15, 23, 42, 0.9); --danger: #ff4757; --success: #2ed573; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: radial-gradient(circle at center, #1a1a2e 0%, #050b18 100%); color: #f8fafc; min-height: 100vh; display: flex; align-items: center; justify-content: center; overflow-x: hidden; }
        
        /* WhatsApp Floating Button */
        .whatsapp-float { position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; background-color: #25d366; color: #FFF; border-radius: 50px; text-align: center; font-size: 30px; box-shadow: 0 4px 15px rgba(37, 211, 102, 0.4); z-index: 1000; display: flex; align-items: center; justify-content: center; text-decoration: none; transition: 0.3s; }
        .whatsapp-float:hover { transform: scale(1.1); background-color: #128c7e; }

        /* UI Styles */
        .user-menu-container { position: fixed; top: 15px; left: 15px; z-index: 2000; }
        .profile-trigger { width: 48px; height: 48px; border-radius: 50%; border: 2px solid var(--primary); cursor: pointer; overflow: hidden; box-shadow: 0 0 15px rgba(0, 242, 255, 0.3); background: var(--glass); }
        .profile-trigger img { width: 100%; height: 100%; object-fit: cover; }
        .dropdown-menu { position: absolute; top: 60px; left: 0; background: var(--glass); border: 1px solid rgba(0, 242, 255, 0.2); border-radius: 20px; width: 220px; display: none; backdrop-filter: blur(20px); padding: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.8); animation: slideDown 0.3s ease; }
        .dropdown-menu.active { display: block; }
        .dropdown-header { padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 8px; text-align: center; }
        .dropdown-header img { width: 50px; height: 50px; border-radius: 50%; border: 2px solid var(--primary); margin-bottom: 5px; }
        .dropdown-menu button { display: flex; align-items: center; gap: 10px; width: 100%; padding: 12px; color: white; background: none; border: none; cursor: pointer; font-size: 14px; border-radius: 10px; transition: 0.2s; text-align: left;}
        .dropdown-menu button:hover { background: rgba(0, 242, 255, 0.1); color: var(--primary); }

        .container { width: 100%; max-width: 450px; padding: 20px; text-align: center; }
        .glass-card { background: var(--glass); border: 1px solid rgba(0, 242, 255, 0.2); padding: 25px; border-radius: 30px; backdrop-filter: blur(25px); margin-bottom: 20px; }
        input { width: 100%; padding: 14px; background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.1); color: #fff; border-radius: 12px; outline: none; margin: 8px 0; }
        .search-bar { border: 1px solid var(--primary); background: rgba(0, 242, 255, 0.05); margin-bottom: 15px; }
        .btn { display: block; width: 100%; padding: 15px; margin-top: 10px; border: none; background: linear-gradient(90deg, var(--primary), var(--secondary)); color: #000; cursor: pointer; font-weight: 800; border-radius: 15px; transition: 0.3s; text-decoration: none; text-transform: uppercase; text-align: center; }
        
        .tool-card { background: rgba(255, 255, 255, 0.03); padding: 15px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 12px; border-radius: 18px; display: flex; align-items: center; gap: 15px; text-align: left; }
        .tool-img { width: 60px; height: 60px; border-radius: 12px; object-fit: cover; border: 2px solid var(--primary); }
        .admin-item { display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 10px; margin-bottom: 8px; font-size: 0.8rem; }
        
        .hidden { display: none !important; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <a href="#" id="wa-floating-btn" class="whatsapp-float hidden" target="_blank">
        <svg style="width:35px;height:35px" viewBox="0 0 24 24"><path fill="currentColor" d="M12.04 2C6.5 2 2 6.5 2 12.04C2 13.81 2.46 15.54 3.33 17.04L2 22L7.13 20.69C8.57 21.47 10.2 21.89 11.9 21.89H12.04C17.57 21.89 22.07 17.4 22.07 11.86C22.07 9.18 21.03 6.67 19.13 4.77C17.23 2.87 14.72 2.03 12.04 2M12.05 3.67C14.28 3.67 16.37 4.54 17.95 6.11C19.53 7.69 20.4 9.77 20.4 12C20.4 16.47 16.71 20.13 12.24 20.13H12.13C10.68 20.13 9.27 19.78 8.03 19.1L7.74 18.94L4.72 19.71L5.5 16.78L5.32 16.5C4.58 15.3 4.19 13.93 4.19 12.5C4.19 8.03 7.85 4.37 12.32 4.37C12.33 4.37 12.35 4.37 12.35 4.37M9.35 8.16C9.17 8.16 8.87 8.23 8.62 8.5C8.37 8.77 7.67 9.42 7.67 10.74C7.67 12.06 8.63 13.34 8.77 13.52C8.91 13.7 10.6 16.41 13.31 17.47C15.58 18.36 16.03 18.18 16.53 18.14C17.03 18.1 18.14 17.47 18.37 16.84C18.6 16.21 18.6 15.66 18.53 15.55C18.46 15.43 18.27 15.37 17.9 15.19C17.53 15.01 15.7 14.11 15.37 13.98C15.03 13.86 14.79 13.8 14.54 14.17C14.3 14.54 13.6 15.37 13.39 15.61C13.18 15.86 12.97 15.89 12.6 15.7C12.23 15.5 10.74 15 8.97 13.43C7.59 12.2 6.66 10.68 6.39 10.22C6.12 9.76 6.37 9.51 6.55 9.33C6.72 9.15 6.93 8.87 7.11 8.66C7.3 8.44 7.37 8.3 7.5 8.03C7.62 7.76 7.56 7.53 7.47 7.35C7.38 7.16 6.65 5.38 6.35 4.65C6.05 3.93 5.75 4.03 5.54 4.02C5.33 4.02 5.09 4.02 4.85 4.02C4.6 4.02 4.22 4.11 3.9 4.46C3.59 4.81 2.7 5.64 2.7 7.33C2.7 9.02 3.93 10.65 4.1 10.88C4.27 11.11 6.5 14.58 10 16.1C13.5 17.62 13.5 17.11 14.12 17.05C14.74 16.99 16.12 16.22 16.4 15.44C16.68 14.66 16.68 14 16.6 13.86C16.5 13.72 16.3 13.66 15.93 13.48" /></svg>
    </a>

    <div id="user-menu" class="user-menu-container hidden">
        <div class="profile-trigger" onclick="toggleDropdown()">
            <img id="top-profile-pic" src="">
        </div>
        <div class="dropdown-menu" id="profile-dropdown">
            <div class="dropdown-header">
                <img id="header-pic" src="">
                <div id="top-user-name" style="font-weight: bold; color: var(--primary); font-size: 14px;">User</div>
            </div>
            <button onclick="tab('tools')">üìÇ Tools List</button>
            <button onclick="tab('profile')">üë§ Profile Settings</button>
            <button onclick="askAdminPass()">‚öôÔ∏è Admin Dashboard</button>
            <button onclick="logout()" style="color: var(--danger); border-top: 1px solid rgba(255,255,255,0.1); margin-top: 5px;">üö™ Logout</button>
        </div>
    </div>

    <div id="screen-login" class="container">
        <h1 style="font-family:'Orbitron'; color:var(--primary); margin-bottom: 15px;">GAMING HUB</h1>
        <div class="glass-card">
            <input type="email" id="user-email" placeholder="Email">
            <input type="password" id="user-pass" placeholder="Password">
            <button class="btn" onclick="handleAuth()">Login / Sign Up</button>
            <div style="display: flex; gap: 10px; margin-top: 10px;">
                <button class="btn" style="background: white; color: black; flex: 1; font-size: 0.7rem;" onclick="loginSocial()">Google</button>
                <button class="btn" style="background: #24292e; color: white; flex: 1; font-size: 0.7rem;" onclick="loginGitHub()">GitHub</button>
            </div>
        </div>
    </div>

    <div id="screen-verify" class="container hidden">
        <h2 style="color: gold; margin-bottom: 15px;">Verification</h2>
        <div class="glass-card">
            <a href="#" id="s1_link" class="btn" target="_blank" onclick="markStep(1)">Step 1: TikTok</a>
            <a href="#" id="s2_link" class="btn" target="_blank" onclick="markStep(2)">Step 2: YouTube</a>
            <a href="#" id="s3_link" class="btn" target="_blank" onclick="markStep(3)">Step 3: WhatsApp</a>
            <button id="unlock-btn" class="btn hidden" style="background:var(--success); color: white;" onclick="startTimer()">Unlock Now</button>
            <div id="timer-box" class="hidden" style="margin-top: 10px; color: gold;">Processing: <span id="sec">15</span>s</div>
        </div>
    </div>

    <div id="screen-content" class="container hidden">
        <h2 id="view-title" style="margin-bottom: 20px; color: var(--primary); font-family: 'Orbitron';">TOOLS</h2>
        <div id="tab-tools-view">
            <input type="text" id="tool-search" class="search-bar" placeholder="üîç Search Tools..." onkeyup="filterTools()">
            <div id="tools-list"></div>
        </div>
        <div id="tab-profile-view" class="hidden">
            <div class="glass-card">
                <img id="profile-pic" src="" style="width:90px; height:90px; border-radius:50%; border:2px solid var(--primary); margin-bottom:15px;">
                <h3 id="profile-name-view">...</h3>
                <p id="profile-email-view" style="opacity:0.5; font-size: 0.8rem; margin-bottom: 15px;"></p>
                <input type="text" id="edit-name" placeholder="New Name">
                <button class="btn" onclick="updateProfile()">Save Name</button>
            </div>
        </div>
    </div>

    <div id="screen-admin" class="container hidden">
        <div class="glass-card" style="text-align: left; max-height: 85vh; overflow-y: auto;">
            <h2 style="color:var(--primary); text-align: center;">ADMIN PANEL</h2>
            
            <p style="margin-top: 15px; font-weight: bold; color: var(--primary);">Contact Settings (Floating WA)</p>
            <div style="display: flex; gap: 8px;">
                <input type="text" id="set_wa_num" placeholder="923001234567" style="flex: 2; margin: 0;">
                <button onclick="saveWhatsAppNumber()" style="flex: 1; background: var(--success); color: white; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 0.7rem;">SAVE</button>
            </div>

            <hr style="margin: 20px 0; border: 0; border-top: 1px solid rgba(255,255,255,0.1);">

            <p style="font-weight: bold; color: var(--primary);">Add Tool</p>
            <input type="text" id="t_name" placeholder="Tool Name">
            <input type="text" id="t_url" placeholder="Download Link">
            <input type="text" id="t_pic" placeholder="Icon URL">
            <input type="text" id="t_vid" placeholder="Video URL">
            <button class="btn" onclick="uploadTool()">Upload Tool</button>

            <p style="margin-top: 20px; font-weight: bold; color: var(--primary);">Verification Links</p>
            <input type="text" id="set_tk" placeholder="TikTok Link">
            <input type="text" id="set_yt" placeholder="YouTube Link">
            <input type="text" id="set_wa" placeholder="WhatsApp Link">
            <button class="btn" onclick="updateSettings()">Save All Links</button>

            <p style="margin-top: 20px; font-weight: bold; color: var(--danger);">Manage Tools</p>
            <div id="admin-tools-manage"></div>
            
            <button class="btn" style="background:#333; color:#fff;" onclick="location.reload()">Back</button>
        </div>
    </div>

    <div id="screen-blocked" class="container hidden">
        <div class="glass-card"><h1 style="color:var(--danger);">BANNED</h1><button class="btn" onclick="logout()">Logout</button></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut, GoogleAuthProvider, GithubAuthProvider, signInWithPopup, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, onSnapshot, query, orderBy, addDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC9THzTxB73m4OpeNE2tkmafvpExIGWlvg",
            authDomain: "gaming-d9494.firebaseapp.com",
            projectId: "gaming-d9494",
            storageBucket: "gaming-d9494.firebasestorage.app",
            messagingSenderId: "464029519961",
            appId: "1:464029519961:web:18db325072160f4c48a148"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let stepsCount = 0;
        let allTools = [];

        onAuthStateChanged(auth, async (user) => {
            if(user) {
                const userRef = doc(db, "users", user.uid);
                let snap = await getDoc(userRef);
                if(!snap.exists()) {
                    await setDoc(userRef, { name: user.displayName || "Gamer", email: user.email, photo: user.photoURL || "https://cdn-icons-png.flaticon.com/512/3135/3135715.png", isVerified: false, isBlocked: false });
                    snap = await getDoc(userRef);
                }
                const userData = snap.data();
                if(userData.isBlocked) { show('screen-blocked'); return; }

                updateProfileUI(userData);
                document.getElementById('user-menu').classList.remove('hidden');
                document.getElementById('wa-floating-btn').classList.remove('hidden');

                if(userData.isVerified) { show('screen-content'); loadTools(); }
                else { show('screen-verify'); loadVerifyLinks(); }
                loadAdminToolsList();
                loadAdminSettings();
            } else {
                show('screen-login');
                document.getElementById('user-menu').classList.add('hidden');
                document.getElementById('wa-floating-btn').classList.add('hidden');
            }
        });

        function updateProfileUI(u) {
            const pic = u.photo || "https://cdn-icons-png.flaticon.com/512/3135/3135715.png";
            document.getElementById('top-profile-pic').src = pic;
            document.getElementById('header-pic').src = pic;
            document.getElementById('profile-pic').src = pic;
            document.getElementById('top-user-name').innerText = u.name;
            document.getElementById('profile-name-view').innerText = u.name;
        }

        window.filterTools = () => {
            const term = document.getElementById('tool-search').value.toLowerCase();
            const filtered = allTools.filter(t => t.name.toLowerCase().includes(term));
            renderToolsList(filtered);
        };

        window.loadTools = () => {
            onSnapshot(query(collection(db, "tools"), orderBy("time", "desc")), (snap) => {
                allTools = snap.docs.map(d => ({id: d.id, ...d.data()}));
                renderToolsList(allTools);
            });
        };

        function renderToolsList(tools) {
            const list = document.getElementById('tools-list'); list.innerHTML = "";
            tools.forEach(data => {
                list.innerHTML += `<div class="tool-card">
                    <img src="${data.pic || 'https://via.placeholder.com/60'}" class="tool-img">
                    <div><b>${data.name}</b><div class="action-btns">
                        <a href="${data.url}" target="_blank" style="color:var(--primary); font-weight:bold; text-decoration:none; font-size:0.8rem;">Download</a>
                        ${data.vid ? `<a href="${data.vid}" target="_blank" style="margin-left:10px; color:#ff0050; font-size:0.8rem;">Video</a>` : ''}
                    </div></div></div>`;
            });
        }

        window.loadAdminSettings = async () => {
            const snap = await getDoc(doc(db, "config", "main"));
            if(snap.exists()){
                const d = snap.data();
                document.getElementById('set_wa_num').value = d.wa_num || "";
                document.getElementById('wa-floating-btn').href = `https://wa.me/${d.wa_num}`;
            }
        };

        window.saveWhatsAppNumber = async () => {
            const num = document.getElementById('set_wa_num').value;
            await setDoc(doc(db, "config", "main"), { wa_num: num }, { merge: true });
            alert("WhatsApp Number Saved!");
            document.getElementById('wa-floating-btn').href = `https://wa.me/${num}`;
        };

        window.updateSettings = async () => {
            await setDoc(doc(db, "config", "main"), { 
                tk: document.getElementById('set_tk').value, 
                yt: document.getElementById('set_yt').value, 
                wa: document.getElementById('set_wa').value 
            }, { merge: true });
            alert("Links Saved!");
        };

        window.loginSocial = () => signInWithPopup(auth, new GoogleAuthProvider());
        window.loginGitHub = () => signInWithPopup(auth, new GithubAuthProvider());
        window.handleAuth = async () => {
            const e = document.getElementById('user-email').value, p = document.getElementById('user-pass').value;
            try { await signInWithEmailAndPassword(auth, e, p); } catch { await createUserWithEmailAndPassword(auth, e, p); }
        };
        window.logout = () => signOut(auth).then(() => location.reload());
        window.toggleDropdown = () => document.getElementById('profile-dropdown').classList.toggle('active');
        window.tab = (t) => {
            document.getElementById('profile-dropdown').classList.remove('active');
            document.getElementById('tab-tools-view').classList.toggle('hidden', t !== 'tools');
            document.getElementById('tab-profile-view').classList.toggle('hidden', t !== 'profile');
            document.getElementById('view-title').innerText = t.toUpperCase();
        };
        window.askAdminPass = () => { if(prompt("Admin Pin:") === "killer786") show('screen-admin'); };
        function show(id) { document.querySelectorAll('.container').forEach(c=>c.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); }
        
        async function loadVerifyLinks() {
            const snap = await getDoc(doc(db, "config", "main"));
            if(snap.exists()){
                const d = snap.data();
                document.getElementById('s1_link').href = d.tk; document.getElementById('s2_link').href = d.yt; document.getElementById('s3_link').href = d.wa;
                document.getElementById('set_tk').value = d.tk; document.getElementById('set_yt').value = d.yt; document.getElementById('set_wa').value = d.wa;
            }
        }
        window.uploadTool = async () => {
            const name = document.getElementById('t_name').value, url = document.getElementById('t_url').value, pic = document.getElementById('t_pic').value, vid = document.getElementById('t_vid').value;
            if(name && url) { await addDoc(collection(db, "tools"), { name, url, pic, vid, time: Date.now() }); alert("Added!"); }
        };
        window.loadAdminToolsList = () => {
            onSnapshot(collection(db, "tools"), (snap) => {
                const list = document.getElementById('admin-tools-manage'); list.innerHTML = "";
                snap.forEach(d => {
                    list.innerHTML += `<div class="admin-item"><span>${d.data().name}</span><button onclick="deleteTool('${d.id}')" style="background:var(--danger); border:none; color:white; padding:5px 10px; border-radius:5px;">Delete</button></div>`;
                });
            });
        };
        window.deleteTool = async (id) => { if(confirm("Delete?")) await deleteDoc(doc(db, "tools", id)); };
        window.markStep = (n) => { stepsCount++; if(stepsCount >= 3) document.getElementById('unlock-btn').classList.remove('hidden'); };
        window.startTimer = () => {
            document.getElementById('timer-box').classList.remove('hidden'); let t = 15;
            let itv = setInterval(async () => {
                t--; document.getElementById('sec').innerText = t;
                if(t <= 0) { clearInterval(itv); await updateDoc(doc(db, "users", auth.currentUser.uid), { isVerified: true }); location.reload(); }
            }, 1000);
        };
        window.updateProfile = async () => {
            const n = document.getElementById('edit-name').value;
            if(n) { await updateDoc(doc(db, "users", auth.currentUser.uid), { name: n }); alert("Updated!"); location.reload(); }
        };
    </script>
</body>
</html>

