<!DOCTYPE html>
<html lang="ur">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAMING HUB | FIXED DELETE</title>
    <style>
        :root { --primary: #00d2ff; --bg: #0f172a; --glass: rgba(30, 41, 59, 0.7); --danger: #ef4444; --video: #ff0050; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: radial-gradient(circle at top right, #1e293b, #0f172a); color: #f8fafc; min-height: 100vh; display: flex; align-items: center; justify-content: center; }
        .container { width: 100%; max-width: 420px; padding: 20px; text-align: center; }
        .glass-card { background: var(--glass); border: 1px solid rgba(255, 255, 255, 0.1); padding: 25px; border-radius: 24px; backdrop-filter: blur(20px); }
        input { width: 100%; padding: 12px; margin: 5px 0; background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(255, 255, 255, 0.1); color: #fff; border-radius: 12px; outline: none; }
        .btn { display: block; width: 100%; padding: 14px; margin-top: 10px; border: none; background: var(--primary); color: #000; cursor: pointer; font-weight: 700; border-radius: 12px; }
        .tool-card { background: rgba(255, 255, 255, 0.05); padding: 15px; border: 1px solid rgba(255, 255, 255, 0.1); margin-bottom: 12px; border-radius: 20px; display: flex; align-items: center; gap: 12px; text-align: left; }
        .tool-img { width: 60px; height: 60px; border-radius: 15px; object-fit: cover; }
        .hidden { display: none !important; }
        #admin-btn { position: fixed; bottom: 20px; right: 20px; opacity: 0.3; cursor: pointer; font-size: 1.5rem; }
        .admin-item { background: rgba(0,0,0,0.3); padding: 12px; border-radius: 12px; margin-bottom: 10px; text-align: left; border-left: 4px solid var(--primary); }
    </style>
</head>
<body>

    <div id="admin-btn" class="hidden" onclick="askAdminPass()">⚙️</div>

    <div id="screen-login" class="container">
        <h1>Gaming Hub</h1>
        <div class="glass-card">
            <input type="email" id="user-email" placeholder="Email">
            <input type="password" id="user-pass" placeholder="Password">
            <button class="btn" onclick="handleAuth()">Login</button>
        </div>
    </div>

    <div id="screen-tools" class="container hidden">
        <h1>Tools Hub</h1>
        <div id="tools-list" style="margin-top:20px;"></div>
        <button class="btn" style="background:none; border:1px solid var(--danger); color:var(--danger);" onclick="logout()">Logout</button>
    </div>

    <div id="screen-admin" class="container hidden">
        <h1>Admin Control</h1>
        <div class="glass-card" style="text-align: left;">
            <input type="text" id="t_name" placeholder="Tool Name">
            <input type="text" id="t_url" placeholder="Download Link">
            <input type="text" id="t_pic" placeholder="Icon Link">
            <button class="btn" onclick="uploadTool()">Upload</button>
            <hr style="margin:20px 0; opacity:0.1;">
            <div id="admin-tools-list"></div>
            <button class="btn" style="background:#334155; color:#fff;" onclick="show('screen-tools')">Back</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC9THzTxB73m4OpeNE2tkmafvpExIGWlvg",
            authDomain: "gaming-d9494.firebaseapp.com",
            projectId: "gaming-d9494",
            storageBucket: "gaming-d9494.firebasestorage.app",
            messagingSenderId: "464029519961",
            appId: "1:464029519961:web:18db325072160f4c48a148"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- AUTH ---
        window.handleAuth = async () => {
            const e = document.getElementById('user-email').value;
            const p = document.getElementById('user-pass').value;
            try { await signInWithEmailAndPassword(auth, e, p); } catch(err) { await createUserWithEmailAndPassword(auth, e, p); }
        };

        onAuthStateChanged(auth, (user) => {
            if(user) { document.getElementById('admin-btn').classList.remove('hidden'); show('screen-tools'); loadTools(); }
        });

        // --- FIXED DELETE ---
        window.deleteTool = async (id) => {
            if(confirm("Confirm Delete?")) {
                try {
                    // Seedha Firestore se delete
                    const docRef = doc(db, "tools", id);
                    await deleteDoc(docRef);
                    alert("Deleted successfully!");
                    // List khud hi update ho jayegi onSnapshot ki wajah se
                } catch (error) {
                    console.error("Error deleting:", error);
                    alert("Error: " + error.message);
                }
            }
        };

        // --- LOAD TOOLS ---
        function loadTools() {
            const q = query(collection(db, "tools"), orderBy("time", "desc"));
            onSnapshot(q, (snap) => {
                const list = document.getElementById('tools-list');
                const adminList = document.getElementById('admin-tools-list');
                list.innerHTML = ""; adminList.innerHTML = "";
                
                snap.forEach(d => {
                    const data = d.data();
                    list.innerHTML += `<div class="tool-card"><img src="${data.pic}" class="tool-img"><div><b>${data.name}</b><br><a href="${data.url}" class="btn" style="padding:5px; font-size:10px;">GET</a></div></div>`;
                    
                    adminList.innerHTML += `<div class="admin-item">
                        <span>${data.name}</span>
                        <button onclick="deleteTool('${d.id}')" style="color:red; float:right; background:none; border:none; cursor:pointer; font-weight:bold;">DELETE</button>
                    </div>`;
                });
            }, (error) => {
                console.log("Snapshot error:", error);
            });
        }

        window.uploadTool = async () => {
            const name = document.getElementById('t_name').value;
            const url = document.getElementById('t_url').value;
            const pic = document.getElementById('t_pic').value;
            if(name && url) {
                await addDoc(collection(db, "tools"), { name, url, pic, time: Date.now() });
                alert("Uploaded!");
            }
        };

        window.askAdminPass = () => { if(prompt("PIN:") === "killer786") show('screen-admin'); };
        window.logout = () => signOut(auth).then(() => location.reload());
        function show(id) { document.querySelectorAll('.container').forEach(c=>c.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); }
    </script>
</body>
</html>

